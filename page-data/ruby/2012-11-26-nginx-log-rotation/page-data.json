{
    "componentChunkName": "component---src-templates-blog-post-js",
    "path": "/ruby/2012-11-26-nginx-log-rotation/",
    "result": {"data":{"site":{"siteMetadata":{"title":"Wlon X Blog"}},"markdownRemark":{"id":"8a21b9d3-9dc9-5788-be43-acd5a3ece90b","excerpt":"转自 Nginx 中文站 nginx 的日志文件没有 rotate 功能。如果你不处理，日志文件将变得越来越大，还好我们可以写一个 nginx 日志切割脚本来自动切割日志文件。 第一步就是重命名日志文件，不用担心重命名后 nginx 找不到日志文件而丢失日志。在你未重新打开原名字的日志文件前，nginx…","html":"<p>转自 Nginx 中文站</p>\n<p>nginx 的日志文件没有 rotate 功能。如果你不处理，日志文件将变得越来越大，还好我们可以写一个 nginx 日志切割脚本来自动切割日志文件。</p>\n<p>第一步就是重命名日志文件，不用担心重命名后 nginx 找不到日志文件而丢失日志。在你未重新打开原名字的日志文件前，nginx 还是会向你重命名的文件写日志，linux 是靠文件描述符而不是文件名定位文件。</p>\n<p>第二步向 nginx 主进程发送 USR1 信号。</p>\n<p>nginx 主进程接到信号后会从配置文件中读取日志文件名称，重新打开日志文件(以配置文件中的日志名称命名)，并以工作进程的用户作为日志文件的所有者。</p>\n<p>重新打开日志文件后，nginx 主进程会关闭重名的日志文件并通知工作进程使用新打开的日志文件。</p>\n<p>工作进程立刻打开新的日志文件并关闭重名名的日志文件。</p>\n<p>然后你就可以处理旧的日志文件了。</p>\n<p>nginx 日志按日期自动切割脚本如下</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">#nginx日志切割脚本\n#author: http://www.nginx.cn\n\n#!/bin/bash\n#设置日志文件存放目录\nlogs_path=\"/usr/local/nginx/logs/\"\n#设置pid文件\npid_path=\"/usr/local/nginx/nginx.pid\"\n\n#重命名日志文件\nmv ${logs_path}access.log ${logs_path}access_$(date -d \"yesterday\" +\"%Y%m%d\").log\n\n#向nginx主进程发信号重新打开日志\nkill -USR1 `cat ${pid_path}`\n</code></pre></div>\n<p>保存以上脚本 nginx_log.sh,或者点此下载</p>\n<p>添加执行权限：</p>\n<p>chmod 744 /root/nginx_log.sh</p>\n<p>让 shell 每天凌晨执行</p>\n<p>crontab -e</p>\n<p>添加内容</p>\n<p>0 0 * * * sh /usr/local/nginx/nginx_log.sh</p>\n<p>保存退出：wq</p>\n<p>这样就每天的 0 点 0 分把 nginx 日志重命名为日期格式，并重新生成今天的新日志文件。</p>","frontmatter":{"title":"Nginx log 分割","date":"November 26, 2012","description":""}},"previous":{"fields":{"slug":"/ruby/2012-07-04-text-mate-shortcut-key/"},"frontmatter":{"title":"Text Mate Shortcut Key"}},"next":{"fields":{"slug":"/ruby/2012-11-27-repleace-string-with-sed/"},"frontmatter":{"title":"Linux下使用正则和sed命令替换文本"}}},"pageContext":{"id":"8a21b9d3-9dc9-5788-be43-acd5a3ece90b","previousPostId":"462fc447-abd8-515c-bc9a-8c8a54e055f8","nextPostId":"2cd3d8a3-52bf-5fab-8ddb-ab7ea41fdfe7"}},
    "staticQueryHashes": ["2841359383","3249277476"]}